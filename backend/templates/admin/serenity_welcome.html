{% load static wagtailadmin_tags %}

<style>
  /* --- SCOPED VARIABLES (Senior Level Encapsulation) --- */

  /* 1. Light Mode (Default) */
  .serenity-dashboard {
    --s-bg: #f8fafc;
    --s-card-bg: #ffffff;
    --s-border: #e2e8f0;
    --s-text-main: #0f172a;
    --s-text-muted: #64748b;
    --s-primary: #0f172a;
    --s-primary-fg: #ffffff;
    --s-accent: #0d9488;
    --s-radius: 6px;
    --s-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --s-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* 2. Dark Mode Override */
  /* This targets .serenity-dashboard ONLY when the html tag has data-theme="dark" */
  html[data-theme="dark"] .serenity-dashboard {
    --s-bg: #0f172a;      /* Slate 900 */
    --s-card-bg: #1e293b; /* Slate 800 */
    --s-border: #334155;  /* Slate 700 */
    --s-text-main: #f1f5f9;
    --s-text-muted: #94a3b8;
    --s-primary: #38bdf8; /* Sky Blue for dark mode */
    --s-primary-fg: #0f172a;
    --s-accent: #2dd4bf;
  }

  /* --- COMPONENT STYLES --- */
  .serenity-dashboard {
    font-family: var(--s-font-family);
    background-color: var(--s-card-bg);
    border: 1px solid var(--s-border);
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 30px;
    color: var(--s-text-main);
    box-shadow: var(--s-shadow);
    animation: fadeIn 0.4s ease-out;
  }

  .sd-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--s-border);
    padding-bottom: 20px;
  }

  .sd-title h2 {
    font-size: 1.25rem;
    font-weight: 700;
    margin: 0 0 4px 0;
    color: var(--s-text-main);
    letter-spacing: -0.025em;
  }

  .sd-title p {
    font-size: 0.875rem;
    color: var(--s-text-muted);
    margin: 0;
    line-height: 1.5;
  }

  .sd-lang-switch {
    display: flex;
    background: var(--s-bg);
    border: 1px solid var(--s-border);
    border-radius: 99px;
    padding: 2px;
    cursor: pointer;
  }

  .sd-lang-opt {
    padding: 4px 12px;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 99px;
    color: var(--s-text-muted);
    transition: all 0.2s ease;
  }

  .sd-lang-opt.active {
    background: var(--s-text-main);
    color: var(--s-bg);
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .sd-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
  }

  .sd-card {
    background: var(--s-bg);
    border: 1px solid var(--s-border);
    border-radius: var(--s-radius);
    padding: 16px;
    display: flex;
    flex-direction: column;
    transition: transform 0.2s, border-color 0.2s;
    position: relative;
    overflow: hidden;
  }

  .sd-card:hover {
    border-color: var(--s-text-muted);
    transform: translateY(-2px);
  }

  .sd-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--s-border);
    opacity: 0.5;
  }

  .sd-card:hover::after {
    background: var(--s-accent);
    opacity: 1;
  }

  .sd-card-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--s-card-bg);
    border: 1px solid var(--s-border);
    border-radius: 6px;
    margin-bottom: 12px;
    color: var(--s-text-main);
  }

  .sd-card-icon svg {
    width: 18px;
    height: 18px;
    stroke-width: 2;
  }

  .sd-card h3 {
    font-size: 0.95rem;
    font-weight: 600;
    margin: 0 0 6px 0;
    color: var(--s-text-main);
  }

  .sd-card p {
    font-size: 0.8rem;
    color: var(--s-text-muted);
    margin: 0 0 16px 0;
    line-height: 1.4;
    flex-grow: 1;
  }

  .sd-actions {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .sd-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 8px 12px;
    border-radius: 4px;
    text-decoration: none;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }

  .sd-btn-primary {
    background-color: var(--s-text-main);
    color: var(--s-bg);
    border: 1px solid transparent;
  }

  .sd-btn-primary:hover {
    background-color: var(--s-text-muted);
    color: #fff;
  }

  .sd-btn-secondary {
    background-color: transparent;
    border: 1px solid var(--s-border);
    color: var(--s-text-muted);
  }

  .sd-btn-secondary:hover {
    border-color: var(--s-text-main);
    color: var(--s-text-main);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 768px) {
    .sd-header { flex-direction: column; gap: 12px; }
    .sd-grid { grid-template-columns: 1fr; }
  }
</style>

<div class="serenity-dashboard" id="serenity-app">
  <div class="sd-header">
    <div class="sd-title">
      <h2 id="txt-welcome">Welcome to Serenity CMS</h2>
      <p id="txt-subtitle">Edit your website content by section.</p>
    </div>

    <div class="sd-lang-switch" id="lang-switch">
      <div class="sd-lang-opt active" data-lang="en">EN</div>
      <div class="sd-lang-opt" data-lang="fr">FR</div>
    </div>
  </div>

  <div class="sd-grid">
    <!-- Hero -->
    <div class="sd-card" data-key="hero">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      </div>
      <h3 class="t-title">Hero Section</h3>
      <p class="t-desc">The first thing visitors see - your main headline and tagline.</p>
      <div class="sd-actions">
        <a href="{{ edit_url }}" class="sd-btn sd-btn-primary t-btn1">Edit Hero</a>
      </div>
    </div>

    <!-- About -->
    <div class="sd-card" data-key="about">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
      </div>
      <h3 class="t-title">About Section</h3>
      <p class="t-desc">Tell your story - introduce yourself and your approach.</p>
      <div class="sd-actions">
        <a href="{{ edit_url }}" class="sd-btn sd-btn-primary t-btn1">Edit About</a>
      </div>
    </div>

    <!-- Services -->
    <div class="sd-card" data-key="services">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
      </div>
      <h3 class="t-title">Services</h3>
      <p class="t-desc">Add, edit, or remove massage services.</p>
      <div class="sd-actions">
        <a href="{{ service_list_url }}" class="sd-btn sd-btn-primary t-btn1">View & Edit Services</a>
        <a href="{{ service_add_url }}" class="sd-btn sd-btn-secondary t-btn2">Add Service</a>
      </div>
    </div>

    <!-- Services Hero -->
    <div class="sd-card" data-key="servicesHero">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
      </div>
      <h3 class="t-title">Services Hero</h3>
      <p class="t-desc">Edit the corporate wellness hero section.</p>
      <div class="sd-actions">
        <a href="{{ edit_url }}" class="sd-btn sd-btn-primary t-btn1">Edit Services Hero</a>
      </div>
    </div>

    <!-- Gift Vouchers -->
    <div class="sd-card" data-key="vouchers">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
      </div>
      <h3 class="t-title">Gift Vouchers</h3>
      <p class="t-desc">Manage gift vouchers, verify codes, and update settings.</p>
      <div class="sd-actions">
        <a href="{{ voucher_list_url }}" class="sd-btn sd-btn-primary t-btn1">Manage Vouchers</a>
        <a href="{{ gift_settings_url }}" class="sd-btn sd-btn-secondary t-btn2">Popup, Email & Form</a>
      </div>
    </div>

    <!-- Testimonials -->
    <div class="sd-card" data-key="testimonials">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
      </div>
      <h3 class="t-title">Testimonials</h3>
      <p class="t-desc">Manage client reviews and ratings shown on your site.</p>
      <div class="sd-actions">
        <a href="{{ testimonial_list_url }}" class="sd-btn sd-btn-primary t-btn1">Manage Reviews</a>
        <a href="{{ testimonial_add_url }}" class="sd-btn sd-btn-secondary t-btn2">Add Review</a>
      </div>
    </div>

    <!-- Replies -->
    <div class="sd-card" data-key="replies">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
      </div>
      <h3 class="t-title">Review Replies</h3>
      <p class="t-desc">Approve or reject replies to testimonials.</p>
      <div class="sd-actions">
        <a href="{{ reply_list_url }}" class="sd-btn sd-btn-primary t-btn1">Manage Replies</a>
      </div>
    </div>

    <!-- Contact -->
    <div class="sd-card" data-key="contact">
      <div class="sd-card-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
      </div>
      <h3 class="t-title">Contact Info</h3>
      <p class="t-desc">Update your contact details shown in the footer.</p>
      <div class="sd-actions">
        <a href="{{ edit_url }}" class="sd-btn sd-btn-primary t-btn1">Edit Contact</a>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const SERENITY_COPY = {
    en: {
      welcome: "Welcome to Serenity CMS",
      subtitle: "Edit your website content by section. Select a card to jump directly to what you want to change.",
      sections: {
        hero: {
          title: "Hero Section",
          desc: "The first thing visitors see - your main headline and tagline at the top of the page.",
          btn1: "Edit Hero"
        },
        about: {
          title: "About Section",
          desc: "Tell your story - introduce yourself, your approach, and your specialties.",
          btn1: "Edit About"
        },
        services: {
          title: "Services",
          desc: "Add, edit, or remove massage services.",
          btn1: "View & Edit Services",
          btn2: "Add Service"
        },
        servicesHero: {
          title: "Services Hero",
          desc: "Edit the corporate wellness hero: title, pricing, CTA, benefits, and background video.",
          btn1: "Edit Services Hero"
        },
        vouchers: {
          title: "Gift Vouchers",
          desc: "Manage gift vouchers year-round. View sold vouchers, verify codes, and update popup + email wording.",
          btn1: "Manage Vouchers",
          btn2: "Popup, Email & Form"
        },
        testimonials: {
          title: "Testimonials",
          desc: "Manage client reviews and ratings shown on your site.",
          btn1: "Manage Reviews",
          btn2: "Add Review"
        },
        replies: {
          title: "Review Replies",
          desc: "Approve or reject community replies to testimonials.",
          btn1: "Manage Replies"
        },
        contact: {
          title: "Contact Info",
          desc: "Update your contact details shown in the footer and throughout the site.",
          btn1: "Edit Contact"
        }
      }
    },
    fr: {
      welcome: "Bienvenue sur Serenity CMS",
      subtitle: "Modifiez le contenu de votre site web par section. Sélectionnez une carte pour accéder directement.",
      sections: {
        hero: {
          title: "Section Héro",
          desc: "La première chose que les visiteurs voient — votre titre principal et slogan.",
          btn1: "Modifier Héro"
        },
        about: {
          title: "Section À Propos",
          desc: "Racontez votre histoire — présentez-vous, votre approche et vos spécialités.",
          btn1: "Modifier À Propos"
        },
        services: {
          title: "Services",
          desc: "Ajoutez, modifiez ou supprimez des services de massage.",
          btn1: "Voir & Modifier Services",
          btn2: "Ajouter Service"
        },
        servicesHero: {
          title: "Héro Services",
          desc: "Modifiez l'héro bien-être en entreprise : titre, prix, CTA, bénéfices et vidéo.",
          btn1: "Modifier Héro Services"
        },
        vouchers: {
          title: "Bons Cadeaux",
          desc: "Gérez les bons cadeaux toute l'année. Consultez les ventes et mettez à jour le popup + l'email.",
          btn1: "Gérer les Bons",
          btn2: "Popup, Email & Formulaire"
        },
        testimonials: {
          title: "Témoignages",
          desc: "Gérez les avis et notes des clients affichés sur votre site.",
          btn1: "Gérer Avis",
          btn2: "Ajouter Avis"
        },
        replies: {
          title: "Réponses aux Avis",
          desc: "Approuvez ou rejetez les réponses de la communauté.",
          btn1: "Gérer Réponses"
        },
        contact: {
          title: "Info Contact",
          desc: "Mettez à jour vos coordonnées affichées dans le pied de page.",
          btn1: "Modifier Contact"
        }
      }
    }
  };

  const root = document.getElementById("serenity-app");
  if(!root) return;

  const getLang = () => localStorage.getItem("serenity_lang") || "en";
  const setLang = (l) => localStorage.setItem("serenity_lang", l);

  const txtWelcome = document.getElementById("txt-welcome");
  const txtSubtitle = document.getElementById("txt-subtitle");
  const langBtns = document.querySelectorAll(".sd-lang-opt");

  const fill = (lang) => {
    const D = SERENITY_COPY[lang];
    txtWelcome.textContent = D.welcome;
    txtSubtitle.textContent = D.subtitle;

    langBtns.forEach(btn => {
      if(btn.dataset.lang === lang) btn.classList.add("active");
      else btn.classList.remove("active");
    });

    document.querySelectorAll(".sd-card").forEach(card => {
      const key = card.getAttribute("data-key");
      const c = D.sections[key];
      if (!c) return;

      card.querySelector(".t-title").textContent = c.title;
      card.querySelector(".t-desc").textContent = c.desc;

      const btn1 = card.querySelector(".t-btn1");
      if (btn1) btn1.textContent = c.btn1;

      const btn2 = card.querySelector(".t-btn2");
      if (btn2 && c.btn2) {
        btn2.textContent = c.btn2;
        btn2.style.display = "";
      } else if (btn2) {
        btn2.style.display = "none";
      }
    });
  };

  let lang = getLang();
  if (!["en","fr"].includes(lang)) lang = "en";
  fill(lang);

  langBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      lang = btn.dataset.lang;
      setLang(lang);
      fill(lang);
    });
  });
});
</script>
